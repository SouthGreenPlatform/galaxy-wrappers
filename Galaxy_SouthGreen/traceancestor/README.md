TraceAncestor.pl is a script that permits to estimate the allelic dosage of ancestral alleles in hybrid individuals and then to perform chromosom painting.


# TUTORIEL

## TAvcf2gst.pl

### Usage

This script is used to define GST values from individuals that are identified as pure breed for an ancestor.

Must be used on pure breed. If there is introgressed part on the genome of the individual, the part must be removed before analysis. 
	
	perl TAvcf2gst.pl [-v vcf file] [-a ancestor file] [-d depth]

### Inputs

	-v | --vcf: vcf containing the pure breed individuals. 

	-a | --ancestor :  ancestor file.


*example:*

| A1 | Ind1 | Ind2 | Ind3 | Ind4 | Ind5 | Ind6 |
|----|------|------|------|------|------|------|
| A2 | Ind7 | Ind8 | Ind9 | Ind10 |
| A3 | Ind11 | Ind12 | Ind13 | Ind14 | Ind15 | 
| A4 | Ind16 | Ind17 |

	-d | --depth : minimal depth for a snp to be used in the analysis (default = 5)

### Ouputs

*example:*

| #CHROM | POS | REF | ALT | %Nref | GST1 | GST2 | GST3 | F1 | F2 | F3 |
|--------|-----|-----|-----|-------|------|------|------|----|----|----|
| 1 | 85524 | A | G | 0.3103448276 | 0.2 | 0.2 | 1 | 0 | 0 | 1 |

*with :* 

- #CHROM = chromosome name
- POS = position of DSNP
- REF = Base of the reference allele of this DSNP
- ALT = Base of the alternative allele of this DSNP
- %Nref = Percentage of maximal missing data for this DSNP
- GST = value of GST (inter-population differentiation parameter) (With 1,2,3 the ancestors names)
- F = Alternative allele frequency for each ancestor (With 1,2,3 the ancestors names)

## TAprefilter.pl

### Usage

This script is used to define a matrix of ancestry informative markers from an other matrix containing GST (inter-population differentiation parameter) information.

	perl TAprefilter.pl [-t matrix file] [-g threshold for gst] [-m threshold for missing data]

### Inputs

	-t | --input : reference matrice with GST and alternative allele frequence (F) informations.

*example:*

| #CHROM | POS | REF | ALT | %Nref | GST1 | GST2 | GST3 | F1 | F2 | F3 |
|--------|-----|-----|-----|-------|------|------|------|----|----|----|
| 1 | 85524 | A | G | 0.3103448276 | 0.2 | 0.2 | 1 | 0 | 0 | 1 |

*with :* 

- #CHROM = chromosome name
- POS = position of DSNP
- REF = Base of the reference allele of this DSNP
- ALT = Base of the alternative allele of this DSNP
- %Nref = Percentage of maximal missing data for this DSNP
- GST = value of GST (inter-population differentiation parameter) (With 1,2,3 the ancestors names)
- F = Alternative allele frequency for each ancestor (With 1,2,3 the ancestors names)

	-g | --gst : maximum value of the GST of a DSNP to be a marker (default = 0.9). 

	-m | --missing : maximum value of missing data frequence for a DSNP to be a marker (default = 0.3) 

### Ouputs

A matrix containing all the ancestry informative markers for every ancestors.

*example:*

| ancestor | chromosome | position | allele |
|----------|------------|----------|--------|
| A1 | 1 | 150528 | T |

*with:*

- ancestor = Ancestor names
- chromosome = Chromosome numbers
- position = Position of the DSNP marker
- allele = Base of the ancestral allele

## TraceAncestor.pl

### Usage

	perl TraceAncestor.pl [-t matrix file] [-v vcf file] [-m merge] [-c color file] [-p ploidy] [-w number of markers by window] [-l LOD value] [-s threshold for LOD] [-k window size in K-bases] [-i particular hybrid to focus on] [-f focus file with several hybrids to focus on] 

### Inputs

	-t | --input : reference matrice. 

*example:*

| ancestor | chromosome | position | allele |
|----------|------------|----------|--------|
| A1 | 1 | 150528 | T |

*with:*
 
- ancestor = Ancestor names
- chromosome = Chromosome numbers
- position = Position of the DSNP marker
- allele = Base of the ancestral allele

--> this file can be generated by TAprefilter.pl

	-v | --vcf : vcf of the hybrid population
	
	-m | --merge : If this option is activated, the windows will be made only with common SNP between vcf and ancestor matrix (do not activate this option if the snp list in ancestor matrix is not exhaustive. For instance in the case of wgs analysis.)

	-c | --color : color file

Color file where the user can choose one color for each ancestor for the painting. The ancestor matrix should have the same number of ancestors than the color file. They should also have the same names.
You can associate a color with NA as ancestor for bands with indetermintation. If you don't, indeterminations (NA) will be grey.
If you use the ideogram output for all or several hybrids, the bands between chromosoms will always be black.

*example:*

| A1 | #DF0101 |
|----|---------|
| A2 | #0000FF |
| A3 | #FFFF00 |
| A4 | #292A0A |


	-p | --ploidy : ploidy of the hybrid population (2, 3 or 4).

	-w | --window : number of markers by window (default = 10)

	-l | --lod : lod value to conclude for one hypothesis or an other (default = 3)

	-s | --threshold : threshold for the calcul of LOD score (default = 0.99 (For an acceptable sequencage error rate of 0.01))

	-k | --cut : number of K bases for one window (default = 100)

	-i | --ind : particular hybrid you want to focus on (optional). If -f not indicated. 

	-f | --focus : file containing several hybrids to focus on (more than one). If -i not indicated (optional). If -i and -f are blank, focus on all hybrids.

	-h | --help : display an help

### Ouputs

- You can visualize ideogram outputs with:

<http://genomeharvest.southgreen.fr/visu/ideogram/newindex.php>

- You can visualize circos outputs with:

<http://genomeharvest.southgreen.fr/visu/circosJS/demo/index.php>


- If -i is filled: Focus on only one hybrid. Visualization will be chromosome by chromosome.
	
	1- *ideogram_hybridname* : the painting data. An Ideogram output compatible with ideogram.js
	
	2- *len_ideogram_hybridname* : the chromosomes data. An Ideogram output compatible with ideogram.js
	
	3- *ancestorFreq* : frequency of ancestors alleles along chromosome for the particular hybrid focused.


- If -f is filled or if none is filled : Focus on several hybrids. Visualization will be genome by genome (chromosomes glued together)

	1- *ideogram_allInd* : the painting data. An output compatible with ideogram.js. Instead of a normal ideogram, chromosomes are replaces by hybrids. Each chromosomes is put side to side to represent the whole genome.
	
	2- *len_allInd_ideogram* : the chromosomes data. Length of the representation of genomes of each hybrids. An output compatible with ideogram.js
	
	3- *ancestorFreq* : frequency of ancestors alleles along chromosome for all the hybrids in the vcf or in the focus_file.
	
	4- *circos* : the painting data. An output compatible with circos.js

	5- *len_allInd_Circos* : the chromosomes data. An output compatible with circos.js


## TAvcf2gst.xml, TAprefilter.xml and TraceAncestor.xml 

These are galaxy wrappers for TraceAncestor
TraceAncestor disponible on the SouthGreen galaxy: <http://galaxy.southgreen.fr/galaxy/>
